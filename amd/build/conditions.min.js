define(["jquery"],function(a){var b=function(b,c,d,e){this.fieldName=b,this.conditions=a.parseJSON(c);var f=[];this.conditions.forEach(function(b){b.hiddenfields.forEach(function(b){-1==a.inArray(b,f)&&f.push(b)}),b.requiredfields.forEach(function(b){-1==a.inArray(b,f)&&f.push(b)})}),this.allElements=f,this.hiddenElements={},this.hideAll=1==d,this.reqHTML=e,this.initApplyRule(),a("#id_profile_field_"+b).change(this.applyRule.bind(this)),a("#id_profile_field_"+b).closest("form").submit(this.beforeSubmit.bind(this))};return b.prototype.fieldName=null,b.prototype.conditions=null,b.prototype.allElements=null,b.prototype.hiddenElements=null,b.prototype.hideAll=null,b.prototype.options=null,b.prototype.beforeSubmit=function(b){if(!b.isDefaultPrevented())for(var c in this.hiddenElements)this.hiddenElements[c]=a("#fitem_id_profile_field_"+c).html(),a("#fitem_id_profile_field_"+c).html("")},b.prototype.initReqStars=function(){var b=[],c=[];this.allElements.forEach(function(c){0!==a("#fitem_id_profile_field_"+c).find(".fitemtitle .req").length&&b.push(c)}),this.hideAll&&this.conditions.forEach(function(a){a.hiddenfields.forEach(function(a){c.push(a)})}),this.conditions.push({option:"",hiddenfields:c,requiredfields:b})},b.prototype.toggleReqStars=function(){var b,c,d=a("#id_profile_field_"+this.fieldName).val(),e=this.reqHTML,f=this.allElements;this.conditions.forEach(function(g){g.option==d&&(b=g.requiredfields,f.forEach(function(d){-1!=a.inArray(d,b)?(c=a("#fitem_id_profile_field_"+d).find(".fitemtitle .req"),0===c.length&&(c=a(e).hide(),a("#fitem_id_profile_field_"+d).find(".fitemtitle label").append(c)),c.show("slow")):a("#fitem_id_profile_field_"+d).find(".fitemtitle .req").hide("slow",function(){-1!=a.inArray(d,b)&&a("#fitem_id_profile_field_"+d).find(".fitemtitle .req").remove()})}))})},b.prototype.applyRule=function(){var b,c=this.hiddenElements,d=a("#id_profile_field_"+this.fieldName).val(),e=this.hideAll,f=null;this.conditions.forEach(function(g){if(""===d)if(e)b={},g.hiddenfields.forEach(function(b){b in c||(c[b]="",a("#fitem_id_profile_field_"+b).hide("slow"))});else for(f in c)c[f]&&a("#fitem_id_profile_field_"+f).html(c[f]),a("#fitem_id_profile_field_"+f).show("slow"),delete c[f];if(g.option==d){for(f in c)-1==a.inArray(f,g.hiddenfields)&&(c[f]&&a("#fitem_id_profile_field_"+f).html(c[f]),a("#fitem_id_profile_field_"+f).show("slow"),delete c[f]);g.hiddenfields.forEach(function(b){b in c||(c[b]="",a("#fitem_id_profile_field_"+b).hide("slow"))})}}),this.hiddenElements=c,this.toggleReqStars()},b.prototype.initApplyRule=function(){var b=this.hiddenElements,c=this.hideAll;c&&this.conditions.forEach(function(c){c.hiddenfields.forEach(function(c){c in b||(b[c]="",a("#fitem_id_profile_field_"+c).hide())})}),this.hiddenElements=b,this.initReqStars(),this.applyRule()},b.prototype.getHiddenArea=function(){var b,c;return b=document.getElementById("id_profilefield_conditional_disable_area_"+this.fieldName),b||(c=a("#mform1"),b=document.createElement("fieldset"),b.id="id_profilefield_conditional_disable_area_"+this.fieldName,b["class"]="hidden",c.append(b)),b.innerHTML="",b},{apply:function(a,c,d,e){return new b(a,c,d,e)}}});